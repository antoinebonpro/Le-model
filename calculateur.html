<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculateur URM Mondial - Tous les Pays</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'urm-blue': '#3b82f6',
                        'urm-red': '#ef4444',
                        'urm-green': '#22c55e'
                    }
                }
            }
        }
    </script>
    <style>
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .country-card {
            transition: all 0.3s ease;
        }
        .country-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        .data-badge {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .country-item {
            transition: all 0.2s ease;
        }
        .country-item:hover {
            background: rgba(59, 130, 246, 0.1);
        }
        .country-item.selected {
            background: rgba(34, 197, 94, 0.15);
            border-color: #22c55e;
        }
        .search-highlight {
            background-color: yellow;
            font-weight: bold;
        }
        #country-search:focus {
            outline: none;
            ring: 2px;
            ring-color: #3b82f6;
        }
        .selected-badge {
            animation: bounceIn 0.3s ease;
        }
        @keyframes bounceIn {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100">

    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-50 bg-white/95 dark:bg-gray-900/95 backdrop-blur-md border-b border-gray-200 dark:border-gray-700">
        <div class="max-w-7xl mx-auto px-6">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-green-600 to-blue-600 rounded-lg flex items-center justify-center">
                        <i class="fas fa-globe text-white text-xl"></i>
                    </div>
                    <div class="hidden md:block">
                        <h1 class="text-xl font-bold text-gray-900 dark:text-white">Calculateur URM</h1>
                        <p class="text-xs text-gray-600 dark:text-gray-400">Tous les Pays du Monde</p>
                    </div>
                </div>
                
                <div class="hidden lg:flex items-center space-x-4">
                    <a href="index.html" class="text-gray-700 dark:text-gray-300 hover:text-blue-600 px-3 py-2 rounded-lg transition-colors">üè† Accueil</a>
                    <a href="france2025.html" class="text-gray-700 dark:text-gray-300 hover:text-blue-600 px-3 py-2 rounded-lg transition-colors">üá´üá∑ France</a>
                    <a href="calculateur.html" class="text-blue-600 dark:text-blue-400 font-semibold px-3 py-2 rounded-lg bg-blue-50 dark:bg-blue-900/30">üåç Calculateur</a>
                    <a href="simulateur.html" class="text-gray-700 dark:text-gray-300 hover:text-blue-600 px-3 py-2 rounded-lg transition-colors">üéõÔ∏è Simulateur</a>
                    <a href="comparateur.html" class="text-gray-700 dark:text-gray-300 hover:text-blue-600 px-3 py-2 rounded-lg transition-colors">‚öñÔ∏è Comparateur</a>
                    <a href="classement.html" class="text-gray-700 dark:text-gray-300 hover:text-blue-600 px-3 py-2 rounded-lg transition-colors">üèÜ Classement</a>
                    <a href="carte.html" class="text-gray-700 dark:text-gray-300 hover:text-blue-600 px-3 py-2 rounded-lg transition-colors">üó∫Ô∏è Carte</a>
                    <a href="timeline.html" class="text-gray-700 dark:text-gray-300 hover:text-blue-600 px-3 py-2 rounded-lg transition-colors">üìÖ Timeline</a>
                    
                    <!-- Dropdown Plus -->
                    <div class="relative group">
                        <button class="text-gray-700 dark:text-gray-300 hover:text-blue-600 px-3 py-2 rounded-lg transition-colors flex items-center">
                            Plus <i class="fas fa-chevron-down ml-1 text-xs"></i>
                        </button>
                        <div class="absolute top-full right-0 mt-1 w-48 bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                            <a href="quiz.html" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-t-xl">üéØ Quiz</a>
                            <a href="export.html" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">üì• Export</a>
                            <a href="ressources.html" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">üìö Ressources</a>
                            <a href="methodologie.html" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">üìñ M√©thodologie</a>
                            <a href="contact.html" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-b-xl">üìß Contact</a>
                        </div>
                    </div>
                </div>
                
                <div class="hidden md:flex items-center space-x-3">
                    <button onclick="toggleDarkMode()" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:text-blue-600 transition-colors">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
                
                <!-- Menu Mobile Burger -->
                <button onclick="toggleMobileMenu()" class="lg:hidden p-2 rounded-lg text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>
        </div>
        
        <!-- Menu Mobile -->
        <div id="mobileMenu" class="lg:hidden hidden bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700 px-4 py-3 space-y-1 max-h-96 overflow-y-auto">
            <a href="index.html" class="block px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800">üè† Accueil</a>
            <a href="france2025.html" class="block px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800">üá´üá∑ France 2025</a>
            <a href="calculateur.html" class="block px-3 py-2 rounded-lg bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-400">üåç Calculateur</a>
            <a href="classement.html" class="block px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800">üèÜ Classement</a>
            <a href="carte.html" class="block px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800">üó∫Ô∏è Carte</a>
            <a href="simulateur.html" class="block px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800">üéõÔ∏è Simulateur</a>
            <a href="comparateur.html" class="block px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800">‚öñÔ∏è Comparateur</a>
            <a href="timeline.html" class="block px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800">üìÖ Timeline</a>
            <a href="quiz.html" class="block px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800">üéØ Quiz</a>
            <a href="export.html" class="block px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800">üì• Export</a>
            <a href="ressources.html" class="block px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800">üìö Ressources</a>
            <a href="methodologie.html" class="block px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800">üìñ M√©thodologie</a>
            <a href="contact.html" class="block px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800">üìß Contact</a>
        </div>
    </nav>

    <!-- Header -->
    <header class="bg-gradient-to-r from-green-600 via-teal-600 to-blue-600 text-white pt-20 pb-16">
        <div class="max-w-6xl mx-auto px-6 text-center">
            <div class="mb-6">
                <span class="text-6xl">üåç</span>
            </div>
            <h1 class="text-4xl md:text-6xl font-bold mb-6">
                Calculateur URM <span class="text-yellow-300">Mondial</span>
            </h1>
            <p class="text-xl md:text-2xl opacity-95 mb-4">
                <strong>N'importe quel pays</strong> - Donn√©es en temps r√©el via World Bank + FMI API
            </p>
            <div class="flex justify-center items-center space-x-4 text-sm flex-wrap gap-2">
                <span class="data-badge bg-white/20 px-3 py-1 rounded-full">
                    <i class="fas fa-database mr-1"></i>217 pays disponibles
                </span>
                <span class="data-badge bg-white/20 px-3 py-1 rounded-full">
                    <i class="fas fa-sync-alt mr-1"></i>Donn√©es 2020-2024
                </span>
                <span class="data-badge bg-white/20 px-3 py-1 rounded-full">
                    <i class="fas fa-check-circle mr-1"></i>100% Gratuit
                </span>
            </div>
        </div>
    </header>

    <!-- Statut API -->
    <section class="bg-gray-100 dark:bg-gray-800 py-6">
        <div class="max-w-6xl mx-auto px-6">
            <div class="grid md:grid-cols-3 gap-4">
                <div id="status-countries" class="bg-white dark:bg-gray-700 rounded-lg p-4 flex items-center space-x-3">
                    <div class="w-3 h-3 rounded-full bg-gray-400"></div>
                    <div>
                        <div class="font-bold text-sm">Liste des Pays</div>
                        <div class="text-xs text-gray-500">En attente...</div>
                    </div>
                </div>
                <div id="status-data" class="bg-white dark:bg-gray-700 rounded-lg p-4 flex items-center space-x-3">
                    <div class="w-3 h-3 rounded-full bg-gray-400"></div>
                    <div>
                        <div class="font-bold text-sm">Donn√©es √âconomiques</div>
                        <div class="text-xs text-gray-500">En attente...</div>
                    </div>
                </div>
                <div id="status-calc" class="bg-white dark:bg-gray-700 rounded-lg p-4 flex items-center space-x-3">
                    <div class="w-3 h-3 rounded-full bg-gray-400"></div>
                    <div>
                        <div class="font-bold text-sm">Calculs URM</div>
                        <div class="text-xs text-gray-500">En attente...</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- S√©lection des pays -->
    <section class="py-12">
        <div class="max-w-6xl mx-auto px-6">
            <h2 class="text-3xl font-bold text-center mb-4">üîç Rechercher et S√©lectionner des Pays</h2>
            <p class="text-center text-gray-600 dark:text-gray-400 mb-8">
                Tapez le nom d'un pays ou s√©lectionnez dans la liste - <strong>tous les pays du monde</strong> sont disponibles
            </p>
            
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8">
                <!-- Barre de recherche -->
                <div class="mb-6">
                    <div class="relative">
                        <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        <input 
                            type="text" 
                            id="country-search" 
                            placeholder="Rechercher un pays (ex: Japon, Br√©sil, Nigeria...)" 
                            class="w-full pl-12 pr-4 py-4 text-lg border-2 border-gray-200 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 focus:border-blue-500 transition-colors"
                            oninput="filterCountries(this.value)"
                        >
                        <button onclick="clearSearch()" class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>

                <!-- Pays s√©lectionn√©s -->
                <div class="mb-6">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-bold text-lg">
                            <i class="fas fa-check-circle text-green-500 mr-2"></i>
                            Pays s√©lectionn√©s (<span id="selected-count">0</span>)
                        </h3>
                        <div class="flex space-x-2">
                            <button onclick="clearSelection()" class="text-sm text-red-600 hover:text-red-800 px-3 py-1 rounded hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors">
                                <i class="fas fa-trash-alt mr-1"></i>Vider
                            </button>
                            <button onclick="selectPreset('g20')" class="text-sm text-blue-600 hover:text-blue-800 px-3 py-1 rounded hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors">
                                <i class="fas fa-globe mr-1"></i>G20
                            </button>
                            <button onclick="selectPreset('europe')" class="text-sm text-blue-600 hover:text-blue-800 px-3 py-1 rounded hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors">
                                <i class="fas fa-euro-sign mr-1"></i>Europe
                            </button>
                            <button onclick="selectPreset('nordic')" class="text-sm text-blue-600 hover:text-blue-800 px-3 py-1 rounded hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors">
                                <i class="fas fa-snowflake mr-1"></i>Nordiques
                            </button>
                        </div>
                    </div>
                    <div id="selected-countries" class="flex flex-wrap gap-2 min-h-[50px] p-4 bg-gray-50 dark:bg-gray-700 rounded-xl border-2 border-dashed border-gray-200 dark:border-gray-600">
                        <span class="text-gray-400 text-sm">Cliquez sur les pays ci-dessous pour les ajouter...</span>
                    </div>
                </div>

                <!-- Filtres par r√©gion -->
                <div class="mb-6">
                    <h3 class="font-bold text-sm mb-3 text-gray-600 dark:text-gray-400">
                        <i class="fas fa-filter mr-2"></i>Filtrer par r√©gion :
                    </h3>
                    <div class="flex flex-wrap gap-2">
                        <button onclick="filterByRegion('all')" class="region-btn px-4 py-2 rounded-lg bg-blue-600 text-white text-sm font-medium transition-all hover:scale-105">
                            Tous
                        </button>
                        <button onclick="filterByRegion('ECS')" class="region-btn px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-600 text-sm font-medium transition-all hover:scale-105">
                            üá™üá∫ Europe
                        </button>
                        <button onclick="filterByRegion('NAC')" class="region-btn px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-600 text-sm font-medium transition-all hover:scale-105">
                            üá∫üá∏ Am√©rique Nord
                        </button>
                        <button onclick="filterByRegion('LCN')" class="region-btn px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-600 text-sm font-medium transition-all hover:scale-105">
                            üåé Am√©rique Latine
                        </button>
                        <button onclick="filterByRegion('EAS')" class="region-btn px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-600 text-sm font-medium transition-all hover:scale-105">
                            üåè Asie Est
                        </button>
                        <button onclick="filterByRegion('SAS')" class="region-btn px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-600 text-sm font-medium transition-all hover:scale-105">
                            üáÆüá≥ Asie Sud
                        </button>
                        <button onclick="filterByRegion('MEA')" class="region-btn px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-600 text-sm font-medium transition-all hover:scale-105">
                            üåç Moyen-Orient
                        </button>
                        <button onclick="filterByRegion('SSF')" class="region-btn px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-600 text-sm font-medium transition-all hover:scale-105">
                            üåç Afrique
                        </button>
                    </div>
                </div>

                <!-- Liste des pays -->
                <div class="mb-6">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-bold text-sm text-gray-600 dark:text-gray-400">
                            <i class="fas fa-list mr-2"></i>Pays disponibles (<span id="visible-count">0</span>)
                        </h3>
                        <span id="loading-countries" class="text-sm text-blue-600">
                            <i class="fas fa-spinner fa-spin mr-1"></i>Chargement...
                        </span>
                    </div>
                    <div id="country-list" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-2 max-h-[400px] overflow-y-auto p-2 bg-gray-50 dark:bg-gray-700 rounded-xl">
                        <!-- Les pays seront charg√©s dynamiquement -->
                    </div>
                </div>

                <!-- Bouton de calcul -->
                <div class="flex justify-center">
                    <button onclick="calculateSelectedCountries()" id="calculate-btn" class="bg-gradient-to-r from-green-600 to-blue-600 hover:from-green-700 hover:to-blue-700 text-white px-10 py-4 rounded-xl font-bold text-xl transition-all transform hover:scale-105 shadow-xl disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="fas fa-calculator mr-3"></i>Calculer l'URM des pays s√©lectionn√©s
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Zone de chargement -->
    <div id="loading-zone" class="hidden py-16">
        <div class="max-w-6xl mx-auto px-6 text-center">
            <div class="loading-spinner mx-auto mb-6"></div>
            <h3 class="text-2xl font-bold mb-2">R√©cup√©ration des donn√©es en cours...</h3>
            <p id="loading-status" class="text-gray-600 dark:text-gray-400">Connexion √† World Bank API...</p>
            <div class="mt-6 bg-gray-200 dark:bg-gray-700 rounded-full h-4 max-w-md mx-auto overflow-hidden">
                <div id="loading-progress" class="bg-gradient-to-r from-green-500 to-blue-500 h-full rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>
            <p id="loading-detail" class="mt-4 text-sm text-gray-500"></p>
        </div>
    </div>

    <!-- R√©sultats -->
    <section id="results-section" class="hidden py-16 bg-gray-100 dark:bg-gray-800">
        <div class="max-w-7xl mx-auto px-6">
            <h2 class="text-3xl font-bold text-center mb-2">
                üèÜ Classement URM - <span class="text-green-600">Donn√©es Temps R√©el</span>
            </h2>
            <p class="text-center text-gray-600 dark:text-gray-400 mb-8">
                Source: World Bank Open Data + FMI DataMapper | Derni√®res donn√©es disponibles
            </p>
            
            <!-- Graphique -->
            <div class="bg-white dark:bg-gray-900 rounded-2xl shadow-xl p-8 mb-8">
                <canvas id="urmWorldChart"></canvas>
            </div>
            
            <!-- Podium -->
            <div id="podium" class="hidden mb-8">
                <h3 class="text-2xl font-bold text-center mb-6">ü•á Podium URM</h3>
                <div class="flex justify-center items-end space-x-4" id="podium-content">
                    <!-- G√©n√©r√© dynamiquement -->
                </div>
            </div>
            
            <!-- Cartes des pays -->
            <div id="country-cards" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Les cartes seront g√©n√©r√©es dynamiquement -->
            </div>
        </div>
    </section>

    <!-- Tableau d√©taill√© -->
    <section id="data-table-section" class="hidden py-16">
        <div class="max-w-7xl mx-auto px-6">
            <h2 class="text-3xl font-bold text-center mb-8">üìä Donn√©es Brutes - Sources Officielles</h2>
            
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gradient-to-r from-gray-800 to-gray-700 text-white">
                            <tr>
                                <th class="px-4 py-3 text-left">#</th>
                                <th class="px-4 py-3 text-left">Pays</th>
                                <th class="px-4 py-3 text-right">PIB/hab ($)</th>
                                <th class="px-4 py-3 text-right">Dette (% PIB)</th>
                                <th class="px-4 py-3 text-right">Gini</th>
                                <th class="px-4 py-3 text-right">Sant√© (%)</th>
                                <th class="px-4 py-3 text-right">√âducation (%)</th>
                                <th class="px-4 py-3 text-right">Mobilit√©</th>
                                <th class="px-4 py-3 text-right font-bold text-yellow-300">URM</th>
                            </tr>
                        </thead>
                        <tbody id="data-table-body" class="divide-y divide-gray-200 dark:divide-gray-700">
                            <!-- Les donn√©es seront g√©n√©r√©es dynamiquement -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="mt-6 bg-blue-50 dark:bg-blue-900/20 rounded-xl p-6">
                <h4 class="font-bold text-blue-800 dark:text-blue-300 mb-3"><i class="fas fa-info-circle mr-2"></i>Note sur les donn√©es</h4>
                <ul class="text-sm text-blue-700 dark:text-blue-400 space-y-1">
                    <li>‚Ä¢ <strong>PIB/habitant:</strong> NY.GDP.PCAP.CD (World Bank)</li>
                    <li>‚Ä¢ <strong>Dette publique:</strong> GGXWDG_NGDP (FMI DataMapper) - General Government Gross Debt % PIB</li>
                    <li>‚Ä¢ <strong>Indice Gini:</strong> SI.POV.GINI (World Bank) - Donn√©es 2010-2024</li>
                    <li>‚Ä¢ <strong>D√©penses sant√©:</strong> SH.XPD.CHEX.GD.ZS (World Bank)</li>
                    <li>‚Ä¢ <strong>D√©penses √©ducation:</strong> SE.XPD.TOTL.GD.ZS (World Bank)</li>
                    <li>‚Ä¢ <strong>Mobilit√© sociale:</strong> Estim√©e selon les donn√©es OCDE/pays (coefficient 0-1)</li>
                    <li class="mt-2 pt-2 border-t border-blue-300">üìÖ L'ann√©e entre parenth√®ses indique l'ann√©e de la derni√®re donn√©e disponible</li>
                </ul>
            </div>
        </div>
    </section>

    <!-- Formule -->
    <section class="py-16 bg-gradient-to-r from-blue-600 to-purple-600 text-white">
        <div class="max-w-4xl mx-auto px-6 text-center">
            <h2 class="text-3xl font-bold mb-8">üìê Formule URM v3.0</h2>
            <div class="bg-white/10 backdrop-blur-md rounded-2xl p-8 mb-6">
                <div class="text-2xl md:text-3xl font-bold font-serif italic mb-6">
                    URM = Œº(W) ‚àí 3.2√óœÉ(W) + S ‚àí 1.6√óD<sub>p</sub> ‚àí 2.1√óA√óœÉ(W) + 80 000√óM
                </div>
                <div class="grid md:grid-cols-3 gap-4 text-sm mt-6">
                    <div class="bg-white/10 rounded-lg p-3">
                        <strong>Œº(W)</strong> = PIB/hab √ó 8
                        <br><span class="opacity-75">Patrimoine m√©dian estim√©</span>
                    </div>
                    <div class="bg-white/10 rounded-lg p-3">
                        <strong>œÉ(W)</strong> = (Gini - 25) √ó 7000
                        <br><span class="opacity-75">√âcart-type des richesses</span>
                    </div>
                    <div class="bg-white/10 rounded-lg p-3">
                        <strong>S</strong> = (Sant√©% + √âduc%) √ó 1000
                        <br><span class="opacity-75">Services publics</span>
                    </div>
                    <div class="bg-white/10 rounded-lg p-3">
                        <strong>D<sub>p</sub></strong> = Dette √ó 1000
                        <br><span class="opacity-75">Impact dette publique</span>
                    </div>
                    <div class="bg-white/10 rounded-lg p-3">
                        <strong>A</strong> = Coefficient al√©as
                        <br><span class="opacity-75">Instabilit√© √©conomique</span>
                    </div>
                    <div class="bg-white/10 rounded-lg p-3">
                        <strong>M</strong> = Mobilit√© sociale
                        <br><span class="opacity-75">0 √† 1 (ascenseur social)</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 text-center">
        <p class="mb-4">Calculateur URM Mondial - Donn√©es en temps r√©el pour <strong>tous les pays</strong></p>
        <p class="text-sm text-gray-400">
            API : <a href="https://data.worldbank.org" class="underline hover:text-white">World Bank Open Data</a> | 
            Formule : URM v3.0 | 
            <a href="index.html" class="underline hover:text-white">Retour au mod√®le</a>
        </p>
    </footer>

    <script>
        // ============================================
        // CONFIGURATION
        // ============================================
        const WORLD_BANK_BASE = 'https://api.worldbank.org/v2';
        
        // Tous les pays seront charg√©s dynamiquement
        let ALL_COUNTRIES = [];
        let selectedCountryCodes = new Set();
        let currentRegionFilter = 'all';
        let currentSearchTerm = '';
        let urmChart = null;

        // Donn√©es de r√©f√©rence pour mobilit√© sociale et al√©as (bas√©es sur √©tudes OCDE)
        // Ces donn√©es ne sont pas disponibles via API, on utilise des estimations
        const MOBILITY_DATA = {
            // Nordiques - haute mobilit√©
            'DNK': 0.85, 'NOR': 0.83, 'FIN': 0.80, 'SWE': 0.78, 'ISL': 0.82,
            // Europe de l'Ouest
            'DEU': 0.68, 'NLD': 0.72, 'BEL': 0.70, 'AUT': 0.69, 'CHE': 0.75,
            'FRA': 0.42, 'GBR': 0.50, 'IRL': 0.58, 'LUX': 0.65,
            // Europe du Sud
            'ESP': 0.45, 'ITA': 0.40, 'PRT': 0.48, 'GRC': 0.44,
            // Europe de l'Est
            'POL': 0.52, 'CZE': 0.55, 'HUN': 0.48, 'SVK': 0.50, 'ROU': 0.42, 'BGR': 0.40,
            // Am√©rique du Nord
            'USA': 0.41, 'CAN': 0.60,
            // Asie d√©velopp√©e
            'JPN': 0.55, 'KOR': 0.52, 'SGP': 0.45, 'HKG': 0.42,
            // Oc√©anie
            'AUS': 0.58, 'NZL': 0.62,
            // Am√©rique Latine
            'BRA': 0.30, 'MEX': 0.35, 'ARG': 0.38, 'CHL': 0.40, 'COL': 0.32, 'PER': 0.34,
            // Asie √©mergente
            'CHN': 0.25, 'IND': 0.28, 'IDN': 0.30, 'THA': 0.35, 'VNM': 0.32, 'PHL': 0.28, 'MYS': 0.38,
            // Moyen-Orient
            'SAU': 0.30, 'ARE': 0.35, 'ISR': 0.52, 'TUR': 0.38,
            // Afrique
            'ZAF': 0.25, 'NGA': 0.20, 'EGY': 0.28, 'KEN': 0.25, 'MAR': 0.30
        };

        const ALEA_DATA = {
            // Nordiques - tr√®s stable
            'DNK': 0.08, 'NOR': 0.07, 'FIN': 0.09, 'SWE': 0.10, 'ISL': 0.12,
            // Europe de l'Ouest
            'DEU': 0.12, 'NLD': 0.10, 'BEL': 0.14, 'AUT': 0.11, 'CHE': 0.08,
            'FRA': 0.28, 'GBR': 0.18, 'IRL': 0.16, 'LUX': 0.09,
            // Europe du Sud
            'ESP': 0.25, 'ITA': 0.28, 'PRT': 0.22, 'GRC': 0.35,
            // Europe de l'Est
            'POL': 0.20, 'CZE': 0.15, 'HUN': 0.22, 'SVK': 0.18, 'ROU': 0.30, 'BGR': 0.28,
            // Am√©rique du Nord
            'USA': 0.18, 'CAN': 0.12,
            // Asie d√©velopp√©e
            'JPN': 0.15, 'KOR': 0.20, 'SGP': 0.12, 'HKG': 0.15,
            // Oc√©anie
            'AUS': 0.14, 'NZL': 0.12,
            // Am√©rique Latine
            'BRA': 0.40, 'MEX': 0.35, 'ARG': 0.50, 'CHL': 0.30, 'COL': 0.38, 'PER': 0.35,
            // Asie √©mergente
            'CHN': 0.30, 'IND': 0.40, 'IDN': 0.35, 'THA': 0.28, 'VNM': 0.30, 'PHL': 0.38, 'MYS': 0.22,
            // Moyen-Orient
            'SAU': 0.25, 'ARE': 0.20, 'ISR': 0.25, 'TUR': 0.40,
            // Afrique
            'ZAF': 0.45, 'NGA': 0.55, 'EGY': 0.40, 'KEN': 0.45, 'MAR': 0.35
        };

        // Presets
        const PRESETS = {
            g20: ['USA', 'CHN', 'JPN', 'DEU', 'GBR', 'FRA', 'ITA', 'CAN', 'KOR', 'AUS', 'BRA', 'IND', 'MEX', 'IDN', 'TUR', 'SAU', 'ARG', 'ZAF'],
            europe: ['DEU', 'FRA', 'GBR', 'ITA', 'ESP', 'NLD', 'BEL', 'SWE', 'POL', 'AUT', 'DNK', 'FIN', 'NOR', 'IRL', 'PRT', 'GRC', 'CZE', 'CHE'],
            nordic: ['DNK', 'SWE', 'NOR', 'FIN', 'ISL']
        };

        // ============================================
        // DARK MODE
        // ============================================
        function toggleDarkMode() {
            document.documentElement.classList.toggle('dark');
            localStorage.setItem('darkMode', document.documentElement.classList.contains('dark'));
        }

        if (localStorage.getItem('darkMode') === 'true') {
            document.documentElement.classList.add('dark');
        }

        // ============================================
        // MENU MOBILE
        // ============================================
        function toggleMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            menu.classList.toggle('hidden');
        }

        // ============================================
        // CHARGEMENT DES PAYS DEPUIS L'API
        // ============================================
        async function loadAllCountries() {
            updateStatus('status-countries', 'loading', 'Chargement...');
            
            try {
                // R√©cup√©rer la liste de tous les pays depuis World Bank
                const response = await fetch(`${WORLD_BANK_BASE}/country?format=json&per_page=300`);
                const data = await response.json();
                
                if (data[1]) {
                    ALL_COUNTRIES = data[1]
                        .filter(c => c.region.id !== 'NA' && c.capitalCity) // Exclure les agr√©gats
                        .map(c => ({
                            code: c.id,
                            iso2: c.iso2Code,
                            name: c.name,
                            nameFr: translateCountryName(c.name),
                            region: c.region.id,
                            regionName: c.region.value,
                            incomeLevel: c.incomeLevel.value
                        }))
                        .sort((a, b) => a.nameFr.localeCompare(b.nameFr, 'fr'));
                    
                    updateStatus('status-countries', 'success', `${ALL_COUNTRIES.length} pays charg√©s`);
                    document.getElementById('loading-countries').classList.add('hidden');
                    renderCountryList();
                }
            } catch (error) {
                console.error('Erreur chargement pays:', error);
                updateStatus('status-countries', 'error', 'Erreur API');
            }
        }

        // Traduction basique des noms de pays courants
        function translateCountryName(name) {
            const translations = {
                'Germany': 'Allemagne', 'France': 'France', 'United States': '√âtats-Unis',
                'United Kingdom': 'Royaume-Uni', 'China': 'Chine', 'Japan': 'Japon',
                'Spain': 'Espagne', 'Italy': 'Italie', 'Brazil': 'Br√©sil',
                'India': 'Inde', 'Canada': 'Canada', 'Australia': 'Australie',
                'South Korea': 'Cor√©e du Sud', 'Korea, Rep.': 'Cor√©e du Sud',
                'Netherlands': 'Pays-Bas', 'Belgium': 'Belgique', 'Switzerland': 'Suisse',
                'Sweden': 'Su√®de', 'Norway': 'Norv√®ge', 'Denmark': 'Danemark',
                'Finland': 'Finlande', 'Poland': 'Pologne', 'Portugal': 'Portugal',
                'Greece': 'Gr√®ce', 'Austria': 'Autriche', 'Ireland': 'Irlande',
                'Mexico': 'Mexique', 'Argentina': 'Argentine', 'South Africa': 'Afrique du Sud',
                'Russian Federation': 'Russie', 'Turkiye': 'Turquie', 'Turkey': 'Turquie',
                'Saudi Arabia': 'Arabie Saoudite', 'United Arab Emirates': '√âmirats Arabes Unis',
                'Indonesia': 'Indon√©sie', 'Thailand': 'Tha√Ølande', 'Vietnam': 'Vietnam', 'Viet Nam': 'Vietnam',
                'Malaysia': 'Malaisie', 'Philippines': 'Philippines', 'Singapore': 'Singapour',
                'Egypt, Arab Rep.': '√âgypte', 'Nigeria': 'Nigeria', 'Kenya': 'Kenya',
                'Morocco': 'Maroc', 'Algeria': 'Alg√©rie', 'Tunisia': 'Tunisie',
                'Czech Republic': 'R√©publique Tch√®que', 'Czechia': 'Tch√©quie',
                'Hungary': 'Hongrie', 'Romania': 'Roumanie', 'Bulgaria': 'Bulgarie',
                'Chile': 'Chili', 'Colombia': 'Colombie', 'Peru': 'P√©rou',
                'New Zealand': 'Nouvelle-Z√©lande', 'Israel': 'Isra√´l',
                'Hong Kong SAR, China': 'Hong Kong', 'Iceland': 'Islande',
                'Luxembourg': 'Luxembourg', 'Slovak Republic': 'Slovaquie'
            };
            return translations[name] || name;
        }

        // ============================================
        // AFFICHAGE DES PAYS
        // ============================================
        function renderCountryList() {
            const container = document.getElementById('country-list');
            const filteredCountries = ALL_COUNTRIES.filter(c => {
                const matchesRegion = currentRegionFilter === 'all' || c.region === currentRegionFilter;
                const matchesSearch = currentSearchTerm === '' || 
                    c.nameFr.toLowerCase().includes(currentSearchTerm.toLowerCase()) ||
                    c.name.toLowerCase().includes(currentSearchTerm.toLowerCase()) ||
                    c.code.toLowerCase().includes(currentSearchTerm.toLowerCase());
                return matchesRegion && matchesSearch;
            });

            document.getElementById('visible-count').textContent = filteredCountries.length;

            container.innerHTML = filteredCountries.map(c => `
                <div class="country-item p-3 rounded-lg border-2 cursor-pointer ${selectedCountryCodes.has(c.code) ? 'selected border-green-500 bg-green-50 dark:bg-green-900/20' : 'border-transparent'}" 
                     onclick="toggleCountry('${c.code}')"
                     data-code="${c.code}">
                    <div class="flex items-center space-x-2">
                        <span class="text-xl">${getFlag(c.iso2)}</span>
                        <span class="text-sm font-medium truncate">${c.nameFr}</span>
                    </div>
                    <div class="text-xs text-gray-500 mt-1 truncate">${c.code}</div>
                </div>
            `).join('');
        }

        // Obtenir le drapeau emoji √† partir du code ISO2
        function getFlag(iso2) {
            if (!iso2 || iso2.length !== 2) return 'üè≥Ô∏è';
            const codePoints = iso2
                .toUpperCase()
                .split('')
                .map(char => 127397 + char.charCodeAt(0));
            return String.fromCodePoint(...codePoints);
        }

        // ============================================
        // S√âLECTION DES PAYS
        // ============================================
        function toggleCountry(code) {
            if (selectedCountryCodes.has(code)) {
                selectedCountryCodes.delete(code);
            } else {
                selectedCountryCodes.add(code);
            }
            updateSelectedDisplay();
            renderCountryList();
        }

        function updateSelectedDisplay() {
            const container = document.getElementById('selected-countries');
            document.getElementById('selected-count').textContent = selectedCountryCodes.size;

            if (selectedCountryCodes.size === 0) {
                container.innerHTML = '<span class="text-gray-400 text-sm">Cliquez sur les pays ci-dessous pour les ajouter...</span>';
                return;
            }

            container.innerHTML = Array.from(selectedCountryCodes).map(code => {
                const country = ALL_COUNTRIES.find(c => c.code === code);
                if (!country) return '';
                return `
                    <span class="selected-badge inline-flex items-center space-x-1 bg-green-100 dark:bg-green-800 text-green-800 dark:text-green-100 px-3 py-1 rounded-full text-sm">
                        <span>${getFlag(country.iso2)}</span>
                        <span>${country.nameFr}</span>
                        <button onclick="event.stopPropagation(); toggleCountry('${code}')" class="ml-1 hover:text-red-600">
                            <i class="fas fa-times"></i>
                        </button>
                    </span>
                `;
            }).join('');
        }

        function clearSelection() {
            selectedCountryCodes.clear();
            updateSelectedDisplay();
            renderCountryList();
        }

        function selectPreset(preset) {
            if (PRESETS[preset]) {
                PRESETS[preset].forEach(code => selectedCountryCodes.add(code));
                updateSelectedDisplay();
                renderCountryList();
            }
        }

        // ============================================
        // FILTRES
        // ============================================
        function filterCountries(term) {
            currentSearchTerm = term;
            renderCountryList();
        }

        function clearSearch() {
            document.getElementById('country-search').value = '';
            currentSearchTerm = '';
            renderCountryList();
        }

        function filterByRegion(region) {
            currentRegionFilter = region;
            
            // Mise √† jour des boutons
            document.querySelectorAll('.region-btn').forEach(btn => {
                btn.classList.remove('bg-blue-600', 'text-white');
                btn.classList.add('bg-gray-200', 'dark:bg-gray-600');
            });
            event.target.classList.remove('bg-gray-200', 'dark:bg-gray-600');
            event.target.classList.add('bg-blue-600', 'text-white');
            
            renderCountryList();
        }

        // ============================================
        // STATUS
        // ============================================
        function updateStatus(id, status, message) {
            const el = document.getElementById(id);
            if (!el) return;
            const dot = el.querySelector('div:first-child');
            const text = el.querySelector('div:last-child div:last-child');
            
            dot.className = 'w-3 h-3 rounded-full';
            if (status === 'loading') {
                dot.classList.add('bg-yellow-400', 'animate-pulse');
            } else if (status === 'success') {
                dot.classList.add('bg-green-500');
            } else if (status === 'error') {
                dot.classList.add('bg-red-500');
            }
            text.textContent = message;
        }

        // ============================================
        // R√âCUP√âRATION DES DONN√âES
        // ============================================
        
        // Mapping ISO3 vers code FMI (certains pays ont des codes diff√©rents)
        const ISO3_TO_IMF = {
            // Europe de l'Ouest
            'DEU': 'DEU', 'FRA': 'FRA', 'GBR': 'GBR', 'ITA': 'ITA', 'ESP': 'ESP',
            'NLD': 'NLD', 'BEL': 'BEL', 'CHE': 'CHE', 'AUT': 'AUT', 'PRT': 'PRT',
            'GRC': 'GRC', 'IRL': 'IRL', 'LUX': 'LUX', 'MLT': 'MLT', 'CYP': 'CYP',
            // Scandinavie
            'DNK': 'DNK', 'SWE': 'SWE', 'NOR': 'NOR', 'FIN': 'FIN', 'ISL': 'ISL',
            // Europe de l'Est
            'POL': 'POL', 'CZE': 'CZE', 'HUN': 'HUN', 'ROU': 'ROM', 'BGR': 'BGR',
            'HRV': 'HRV', 'SVK': 'SVK', 'SVN': 'SVN', 'EST': 'EST', 'LVA': 'LVA',
            'LTU': 'LTU', 'SRB': 'SRB', 'BIH': 'BIH', 'MKD': 'MKD', 'ALB': 'ALB',
            'MNE': 'MNE', 'XKX': 'UVK', 'MDA': 'MDA', 'BLR': 'BLR',
            // Ex-URSS
            'RUS': 'RUS', 'UKR': 'UKR', 'KAZ': 'KAZ', 'UZB': 'UZB', 'AZE': 'AZE',
            'GEO': 'GEO', 'ARM': 'ARM', 'TKM': 'TKM', 'KGZ': 'KGZ', 'TJK': 'TJK',
            // Am√©rique du Nord
            'USA': 'USA', 'CAN': 'CAN', 'MEX': 'MEX',
            // Am√©rique du Sud
            'BRA': 'BRA', 'ARG': 'ARG', 'COL': 'COL', 'CHL': 'CHL', 'PER': 'PER',
            'VEN': 'VEN', 'ECU': 'ECU', 'BOL': 'BOL', 'PRY': 'PRY', 'URY': 'URY',
            // Am√©rique Centrale / Cara√Øbes
            'GTM': 'GTM', 'CRI': 'CRI', 'PAN': 'PAN', 'DOM': 'DOM', 'CUB': 'CUB',
            'HND': 'HND', 'SLV': 'SLV', 'NIC': 'NIC', 'JAM': 'JAM', 'TTO': 'TTO',
            // Asie de l'Est
            'JPN': 'JPN', 'CHN': 'CHN', 'KOR': 'KOR', 'TWN': 'TWN', 'HKG': 'HKG',
            'MNG': 'MNG',
            // Asie du Sud-Est
            'IDN': 'IDN', 'THA': 'THA', 'MYS': 'MYS', 'SGP': 'SGP', 'PHL': 'PHL',
            'VNM': 'VNM', 'MMR': 'MMR', 'KHM': 'KHM', 'LAO': 'LAO', 'BRN': 'BRN',
            // Asie du Sud
            'IND': 'IND', 'PAK': 'PAK', 'BGD': 'BGD', 'LKA': 'LKA', 'NPL': 'NPL',
            // Moyen-Orient
            'TUR': 'TUR', 'SAU': 'SAU', 'ARE': 'ARE', 'ISR': 'ISR', 'IRN': 'IRN',
            'IRQ': 'IRQ', 'QAT': 'QAT', 'KWT': 'KWT', 'OMN': 'OMN', 'BHR': 'BHR',
            'JOR': 'JOR', 'LBN': 'LBN', 'SYR': 'SYR', 'YEM': 'YEM',
            // Afrique du Nord
            'EGY': 'EGY', 'MAR': 'MAR', 'DZA': 'DZA', 'TUN': 'TUN', 'LBY': 'LBY',
            // Afrique Sub-saharienne
            'ZAF': 'ZAF', 'NGA': 'NGA', 'KEN': 'KEN', 'ETH': 'ETH', 'GHA': 'GHA',
            'TZA': 'TZA', 'UGA': 'UGA', 'AGO': 'AGO', 'MOZ': 'MOZ', 'CMR': 'CMR',
            'CIV': 'CIV', 'SEN': 'SEN', 'ZMB': 'ZMB', 'ZWE': 'ZWE', 'RWA': 'RWA',
            'MUS': 'MUS', 'BWA': 'BWA', 'NAM': 'NAM', 'GAB': 'GAB', 'COG': 'COG',
            'COD': 'COD', 'MLI': 'MLI', 'BFA': 'BFA', 'NER': 'NER', 'TCD': 'TCD',
            // Oc√©anie
            'AUS': 'AUS', 'NZL': 'NZL', 'FJI': 'FJI', 'PNG': 'PNG'
        };

        // Cache pour les donn√©es FMI (√©vite les appels r√©p√©t√©s)
        let imfDebtCache = null;

        async function fetchWorldBankIndicator(indicator, countries) {
            const countryStr = countries.join(';');
            // √âtendre la p√©riode pour Gini (donn√©es souvent plus anciennes)
            const dateRange = indicator === 'SI.POV.GINI' ? '2010:2024' : '2018:2024';
            const url = `${WORLD_BANK_BASE}/country/${countryStr}/indicator/${indicator}?format=json&date=${dateRange}&per_page=2000`;
            
            try {
                const response = await fetch(url);
                const data = await response.json();
                
                if (data[1]) {
                    const result = {};
                    data[1].forEach(item => {
                        if (item.value !== null) {
                            const code = item.countryiso3code;
                            if (!result[code] || parseInt(item.date) > parseInt(result[code].year)) {
                                result[code] = { value: item.value, year: item.date };
                            }
                        }
                    });
                    return result;
                }
            } catch (error) {
                console.error(`Erreur ${indicator}:`, error);
            }
            return {};
        }

        // R√©cup√©rer les donn√©es de dette depuis l'API FMI (GGXWDG_NGDP)
        async function fetchIMFDebtData() {
            if (imfDebtCache) return imfDebtCache;
            
            const url = 'https://www.imf.org/external/datamapper/api/v1/GGXWDG_NGDP?periods=2024,2023,2022,2021,2020';
            
            try {
                const response = await fetch(url);
                const data = await response.json();
                
                if (data && data.values && data.values.GGXWDG_NGDP) {
                    imfDebtCache = {};
                    const debtData = data.values.GGXWDG_NGDP;
                    
                    // Parcourir tous les pays dans la r√©ponse FMI
                    for (const [countryCode, years] of Object.entries(debtData)) {
                        // Trouver l'ann√©e la plus r√©cente avec des donn√©es
                        for (const year of ['2024', '2023', '2022', '2021', '2020']) {
                            if (years[year] !== undefined && years[year] !== null) {
                                imfDebtCache[countryCode] = { value: years[year], year: year };
                                break;
                            }
                        }
                    }
                    return imfDebtCache;
                }
            } catch (error) {
                console.error('Erreur FMI dette:', error);
            }
            return {};
        }

        // Convertir les donn√©es FMI vers codes ISO3
        function getIMFDebtForCountries(imfData, countries) {
            const result = {};
            for (const iso3 of countries) {
                // Essayer le code direct ou le mapping
                const imfCode = ISO3_TO_IMF[iso3] || iso3;
                if (imfData[imfCode]) {
                    result[iso3] = imfData[imfCode];
                }
            }
            return result;
        }

        // ============================================
        // CALCUL URM
        // ============================================
        function calculateURM(data, countryCode) {
            // Valeurs par d√©faut si donn√©es manquantes
            const gdp = data.gdpPerCapita || 30000;
            const gini = data.gini || 35;
            const debt = data.debt || 60;
            const health = data.health || 8;
            const education = data.education || 5;
            const mobility = MOBILITY_DATA[countryCode] || 0.40;
            const alea = ALEA_DATA[countryCode] || 0.25;

            // Calculs interm√©diaires
            const muW = gdp * 8; // Patrimoine m√©dian estim√©
            const sigmaW = Math.max((gini - 25) * 7000, 10000); // √âcart-type (min 10k)
            const services = (health + education) * 1000;
            const debtImpact = 1.6 * debt * 1000;
            const aleaImpact = 2.1 * alea * sigmaW;
            const mobilityBonus = 80000 * mobility;

            // Formule URM v3.0
            const urm = muW - (3.2 * sigmaW) + services - debtImpact - aleaImpact + mobilityBonus;

            return {
                urm: Math.round(urm),
                muW: Math.round(muW),
                sigmaW: Math.round(sigmaW),
                services: Math.round(services),
                debtImpact: Math.round(debtImpact),
                aleaImpact: Math.round(aleaImpact),
                mobilityBonus: Math.round(mobilityBonus),
                mobility,
                alea
            };
        }

        // ============================================
        // CALCUL PRINCIPAL
        // ============================================
        async function calculateSelectedCountries() {
            if (selectedCountryCodes.size === 0) {
                alert('Veuillez s√©lectionner au moins un pays.');
                return;
            }

            const countries = Array.from(selectedCountryCodes);
            
            // Afficher chargement
            document.getElementById('loading-zone').classList.remove('hidden');
            document.getElementById('results-section').classList.add('hidden');
            document.getElementById('data-table-section').classList.add('hidden');
            
            updateStatus('status-data', 'loading', 'Connexion...');
            updateStatus('status-calc', 'loading', 'En attente...');

            try {
                // R√©cup√©ration des donn√©es en parall√®le
                document.getElementById('loading-status').textContent = 'R√©cup√©ration des indicateurs √©conomiques...';
                document.getElementById('loading-detail').textContent = `${countries.length} pays s√©lectionn√©s`;
                document.getElementById('loading-progress').style.width = '10%';

                // R√©cup√©ration World Bank + FMI en parall√®le
                const [gdpData, wbDebtData, giniData, healthData, educData, imfDebtRaw] = await Promise.all([
                    fetchWorldBankIndicator('NY.GDP.PCAP.CD', countries),
                    fetchWorldBankIndicator('GC.DOD.TOTL.GD.ZS', countries), // Backup
                    fetchWorldBankIndicator('SI.POV.GINI', countries),
                    fetchWorldBankIndicator('SH.XPD.CHEX.GD.ZS', countries),
                    fetchWorldBankIndicator('SE.XPD.TOTL.GD.ZS', countries),
                    fetchIMFDebtData() // API FMI pour la dette
                ]);

                document.getElementById('loading-progress').style.width = '50%';
                document.getElementById('loading-status').textContent = 'Traitement des donn√©es FMI...';

                // Convertir les donn√©es FMI vers les codes ISO3
                const imfDebtData = getIMFDebtForCountries(imfDebtRaw, countries);
                
                // Fusionner: priorit√© FMI, sinon World Bank
                const debtData = {};
                for (const code of countries) {
                    if (imfDebtData[code]) {
                        debtData[code] = imfDebtData[code];
                    } else if (wbDebtData[code]) {
                        debtData[code] = wbDebtData[code];
                    }
                }

                document.getElementById('loading-progress').style.width = '60%';
                document.getElementById('loading-status').textContent = 'Calcul des scores URM...';
                updateStatus('status-data', 'success', 'Donn√©es re√ßues (WB + FMI)');

                // Compilation et calcul
                const results = [];
                let processed = 0;

                for (const code of countries) {
                    const countryInfo = ALL_COUNTRIES.find(c => c.code === code);
                    if (!countryInfo) continue;

                    const rawData = {
                        gdpPerCapita: gdpData[code]?.value,
                        gdpYear: gdpData[code]?.year,
                        debt: debtData[code]?.value,
                        debtYear: debtData[code]?.year,
                        gini: giniData[code]?.value,
                        giniYear: giniData[code]?.year,
                        health: healthData[code]?.value,
                        healthYear: healthData[code]?.year,
                        education: educData[code]?.value,
                        educYear: educData[code]?.year
                    };

                    const urmCalc = calculateURM(rawData, code);

                    results.push({
                        code,
                        ...countryInfo,
                        flag: getFlag(countryInfo.iso2),
                        ...rawData,
                        ...urmCalc
                    });

                    processed++;
                    document.getElementById('loading-progress').style.width = `${60 + (processed / countries.length) * 30}%`;
                }

                // Tri par URM d√©croissant
                results.sort((a, b) => b.urm - a.urm);

                document.getElementById('loading-progress').style.width = '100%';
                document.getElementById('loading-status').textContent = 'Calculs termin√©s !';
                updateStatus('status-calc', 'success', `${results.length} pays calcul√©s`);

                // Affichage
                setTimeout(() => {
                    displayResults(results);
                    document.getElementById('loading-zone').classList.add('hidden');
                    document.getElementById('results-section').classList.remove('hidden');
                    document.getElementById('data-table-section').classList.remove('hidden');
                    
                    // Scroll vers r√©sultats
                    document.getElementById('results-section').scrollIntoView({ behavior: 'smooth' });
                }, 500);

            } catch (error) {
                console.error('Erreur:', error);
                updateStatus('status-data', 'error', 'Erreur connexion');
                document.getElementById('loading-status').textContent = 'Erreur de connexion. R√©essayez.';
            }
        }

        // ============================================
        // AFFICHAGE R√âSULTATS
        // ============================================
        function displayResults(results) {
            // Graphique
            const ctx = document.getElementById('urmWorldChart').getContext('2d');
            if (urmChart) urmChart.destroy();

            // Limiter √† 30 pays pour le graphique
            const chartData = results.slice(0, 30);

            urmChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: chartData.map(r => `${r.flag} ${r.nameFr}`),
                    datasets: [{
                        label: 'Score URM (k‚Ç¨)',
                        data: chartData.map(r => r.urm / 1000),
                        backgroundColor: chartData.map(r => 
                            r.urm > 0 ? 'rgba(34, 197, 94, 0.7)' : 'rgba(239, 68, 68, 0.7)'
                        ),
                        borderColor: chartData.map(r => 
                            r.urm > 0 ? 'rgb(34, 197, 94)' : 'rgb(239, 68, 68)'
                        ),
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    indexAxis: 'y',
                    plugins: {
                        title: {
                            display: true,
                            text: `Classement URM - ${results.length} pays analys√©s`,
                            font: { size: 18, weight: 'bold' }
                        },
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (ctx) => `URM: ${ctx.raw > 0 ? '+' : ''}${ctx.raw.toFixed(0)}k‚Ç¨`
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Score URM (milliers ‚Ç¨)' },
                            grid: { color: (ctx) => ctx.tick.value === 0 ? '#ef4444' : 'rgba(0,0,0,0.1)' }
                        }
                    }
                }
            });

            // Podium (si >= 3 pays)
            if (results.length >= 3) {
                document.getElementById('podium').classList.remove('hidden');
                document.getElementById('podium-content').innerHTML = `
                    <div class="text-center transform translate-y-8">
                        <div class="text-5xl mb-2">${results[1].flag}</div>
                        <div class="bg-gray-300 dark:bg-gray-600 rounded-t-lg p-4 w-32">
                            <div class="text-2xl font-bold">ü•à</div>
                            <div class="font-bold">${results[1].nameFr}</div>
                            <div class="text-sm ${results[1].urm > 0 ? 'text-green-600' : 'text-red-600'}">${(results[1].urm/1000).toFixed(0)}k‚Ç¨</div>
                        </div>
                    </div>
                    <div class="text-center">
                        <div class="text-6xl mb-2">${results[0].flag}</div>
                        <div class="bg-yellow-400 dark:bg-yellow-600 rounded-t-lg p-4 w-36">
                            <div class="text-3xl font-bold">ü•á</div>
                            <div class="font-bold text-lg">${results[0].nameFr}</div>
                            <div class="text-lg ${results[0].urm > 0 ? 'text-green-700' : 'text-red-700'}">${(results[0].urm/1000).toFixed(0)}k‚Ç¨</div>
                        </div>
                    </div>
                    <div class="text-center transform translate-y-12">
                        <div class="text-4xl mb-2">${results[2].flag}</div>
                        <div class="bg-orange-300 dark:bg-orange-700 rounded-t-lg p-4 w-28">
                            <div class="text-xl font-bold">ü•â</div>
                            <div class="font-bold text-sm">${results[2].nameFr}</div>
                            <div class="text-sm ${results[2].urm > 0 ? 'text-green-600' : 'text-red-600'}">${(results[2].urm/1000).toFixed(0)}k‚Ç¨</div>
                        </div>
                    </div>
                `;
            }

            // Cartes des pays
            const cardsContainer = document.getElementById('country-cards');
            cardsContainer.innerHTML = results.map((r, i) => `
                <div class="country-card bg-white dark:bg-gray-900 rounded-2xl shadow-xl p-6 border-l-4 ${r.urm > 0 ? 'border-green-500' : 'border-red-500'}">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center">
                            <span class="text-4xl mr-3">${r.flag}</span>
                            <div>
                                <h3 class="font-bold text-lg">${r.nameFr}</h3>
                                <div class="text-sm ${r.urm > 0 ? 'text-green-600' : 'text-red-600'} font-medium">#${i + 1}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-bold ${r.urm > 0 ? 'text-green-600' : 'text-red-600'}">
                                ${r.urm > 0 ? '+' : ''}${(r.urm / 1000).toFixed(0)}k‚Ç¨
                            </div>
                        </div>
                    </div>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-500">PIB/hab:</span>
                            <span class="font-medium">${r.gdpPerCapita ? Math.round(r.gdpPerCapita).toLocaleString() + ' $' : '‚Äî'}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-500">Dette:</span>
                            <span class="font-medium">${r.debt ? r.debt.toFixed(1) + '%' : '‚Äî'}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-500">Gini:</span>
                            <span class="font-medium">${r.gini ? r.gini.toFixed(1) : '‚Äî'}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-500">Mobilit√©:</span>
                            <span class="font-medium">${(r.mobility * 100).toFixed(0)}%</span>
                        </div>
                    </div>
                </div>
            `).join('');

            // Tableau
            const tableBody = document.getElementById('data-table-body');
            tableBody.innerHTML = results.map((r, i) => `
                <tr class="hover:bg-gray-50 dark:hover:bg-gray-800 ${i < 3 ? 'bg-yellow-50 dark:bg-yellow-900/10' : ''}">
                    <td class="px-4 py-3 font-bold">${i + 1}</td>
                    <td class="px-4 py-3 font-medium">${r.flag} ${r.nameFr}</td>
                    <td class="px-4 py-3 text-right">${r.gdpPerCapita ? Math.round(r.gdpPerCapita).toLocaleString() : '‚Äî'}</td>
                    <td class="px-4 py-3 text-right">${r.debt ? r.debt.toFixed(1) + '%' : '‚Äî'}${r.debtYear ? ' <span class="text-xs text-gray-400">(' + r.debtYear + ')</span>' : ''}</td>
                    <td class="px-4 py-3 text-right">${r.gini ? r.gini.toFixed(1) : '‚Äî'}${r.giniYear ? ' <span class="text-xs text-gray-400">(' + r.giniYear + ')</span>' : ''}</td>
                    <td class="px-4 py-3 text-right">${r.health ? r.health.toFixed(1) + '%' : '‚Äî'}</td>
                    <td class="px-4 py-3 text-right">${r.education ? r.education.toFixed(1) + '%' : '‚Äî'}</td>
                    <td class="px-4 py-3 text-right">${(r.mobility * 100).toFixed(0)}%</td>
                    <td class="px-4 py-3 text-right font-bold text-lg ${r.urm > 0 ? 'text-green-600' : 'text-red-600'}">
                        ${r.urm > 0 ? '+' : ''}${(r.urm / 1000).toFixed(0)}k‚Ç¨
                    </td>
                </tr>
            `).join('');
        }

        // ============================================
        // INITIALISATION
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            loadAllCountries();
        });
    </script>

</body>
</html>
